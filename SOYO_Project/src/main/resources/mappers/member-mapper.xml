<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="memberMapper">

	<!-- 
		MEMBER 테이블 각 컬럼값 -> 자바 Member 클래스 필드값으로 옮기기
	-->
	<resultMap type="member" id="memberResultSet">
		<id column="MEMBER_ID" property="memberId" />
		<result column="MEMBER_PWD" property="memberPwd" />
		<result column="MEMBER_NAME" property="memberName" />
		<result column="GENDER" property="gender" />
		<result column="BIRTH_DATE" property="birthDate" />
		<result column="EMAIL" property="email" />
		<result column="PHONE" property="phone" />
		<result column="ADDRESS" property="address" />
		<result column="ENROLL_DATE" property="enrollDate" />
		<result column="STATUS" property="status" />
	</resultMap>
	
	<resultMap id="deliveryResultSet" type="com.kh.soyo.product.model.vo.Product">
		<result property="receiverName" column="RECEIVER_NAME"/>
		<result property="memberName" column="MEMBER_NAME"/>
	    <result property="productChange" column="PRODUCT_CHANGE"/>
	    <result property="productName" column="PRODUCT_NAME"/>
	    <result property="productCount" column="PRODUCT_COUNT"/>
	    <result property="productPrice" column="PRODUCT_PRICE"/>
	    <result property="deliveryDate" column="DELIVERY_DATE"/>
	    <result property="orderStatus" column="ORDER_STATUS"/>
	    <result property="orderImpno" column="ORDER_IMPNO"/>
	    <result property="addressOther" column="ADDRESS_OTHER"/>
	</resultMap>

	<!-- 로그인용 쿼리문 -->
	<select id="loginMember" parameterType="member"
							 resultMap="memberResultSet">
		SELECT *
		  FROM MEMBER
		 WHERE MEMBER_ID = #{memberId}
		   AND MEMBER_PWD = #{memberPwd}
		   AND STATUS = 'Y'
	</select>
	
	<!-- 회원정보 수정용 쿼리문 -->
	<update id="updateMember" parameterType="member">
		UPDATE MEMBER
			   SET MEMBER_NAME = #{memberName}
	             , GENDER = #{gender}
	             , BIRTH_DATE = #{birthDate}
			     , PHONE = #{phone}
			     , ADDRESS = #{address}
			 WHERE MEMBER_ID = #{memberId}
			   AND STATUS = 'Y'
	</update>
	
	<!-- 회원 삭제용 쿼리문 -->
	<update id="deleteMember" parameterType="string">
		UPDATE MEMBER SET STATUS = 'N'
		    WHERE MEMBER_ID = #{memberId}
		    AND STATUS = 'Y'
	</update>
	
	<!-- 비밀번호 변경용 쿼리문 -->
	<update id="updatePwd" parameterType="hashmap">
		UPDATE MEMBER SET MEMBER_PWD = #{updatePwd}
		    WHERE MEMBER_ID = #{memberId}
		    AND STATUS = 'Y'
	</update>
	

	<!-- 아이디 중복 확인용 쿼리문 -->
	<select id="checkId" parameterType="string" resultType="_int">
	
		SELECT COUNT(*) FROM MEMBER
    	WHERE MEMBER_ID = #{checkId}
    	
	</select>
	
	<select id="orderProduct" parameterType="string"
								resultMap="deliveryResultSet">
								
			SELECT P.PRODUCT_CHANGE,
			       O.ORDER_IMPNO,
			       P.PRODUCT_NAME,
			       P.PRODUCT_PRICE,
			       C.PRODUCT_COUNT,
			       O.DELIVERY_DATE,
			       O.ORDER_STATUS,
                   O.RECEIVER_NAME,
                   M.MEMBER_NAME,
                   D.ADDRESS_OTHER
			FROM CART C
			JOIN ORDER_TB O ON O.MEMBER_ID = C.MEMBER_ID
			JOIN PRODUCT P ON P.PRODUCT_NO = C.PRODUCT_NO
            JOIN MEMBER M ON C.MEMBER_ID = M.MEMBER_ID
            JOIN DELIVERY_ADDRESS D ON O.RECEIVER_NAME = D.RECEIVER_NAME
			WHERE C.MEMBER_ID=#{memberId}
			
	</select>
	
	<!-- 회원가입용 쿼리문 -->
	<select id="insertMember" parameterType="member">
		INSERT INTO MEMBER(MEMBER_ID
                 , MEMBER_PWD
                 , MEMBER_NAME
                 , GENDER
                 , BIRTH_DATE
                 , EMAIL
                 , PHONE
                 , ADDRESS)
        VALUES(#{memberId}
             , #{memberPwd}
             , #{memberName}
             , #{gender}
             , #{birthDate}
             , #{email}
             , #{phone}
             , #{address})
	</select>
	
	<!-- 아이디 찾기용 쿼리문 -->
	<select id="findId" parameterType="member" resultType="string">
		SELECT MEMBER_ID FROM MEMBER
		    WHERE MEMBER_NAME = #{memberName}
		      AND BIRTH_DATE = #{birthDate}
		      AND EMAIL = #{email}
		      AND PHONE = #{phone}
		      AND STATUS = 'Y'
	</select>
	
	<!-- 아이디로 유저 찾기 -->
	<select id="selectMember" resultMap="memberResultSet">
	  SELECT * FROM MEMBER
	  WHERE MEMBER_ID = #{memberId} AND STATUS = 'Y'
	</select>
	
	<!-- 비밀번호 재발급및 변경(기존에 있던 비번변경은 해시맵 타입이라 재활용 불가(바꾸기엔 늦었다)) -->
	<update id="newRandomPwd" parameterType="member">
		UPDATE MEMBER SET MEMBER_PWD = #{memberPwd}
		    WHERE MEMBER_ID = #{memberId}
		    AND STATUS = 'Y'
	</update>
	
	<select id="findEmail" parameterType="member" resultType="string">
		SELECT EMAIL FROM MEMBER
		    WHERE MEMBER_ID = #{memberId}
		    AND STATUS = 'Y'
	</select>
		
</mapper>