<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="reviewMapper">

	<resultMap id="reviewResultMap" type="review">
	    <result property="reviewNo" column="REVIEW_NO"/>
	    <result property="reviewTitle" column="REVIEW_TITLE"/>
	    <result property="reviewContent" column="REVIEW_CONTENT"/>
	    <result property="rating" column="RATING"/>
	    <result property="reviewThumbnailOrigin" column="REVIEW_THUMBNAIL_ORIGIN"/>
	    <result property="reviewThumbnailChange" column="REVIEW_THUMBNAIL_CHANGE"/>
	    <result property="reviewDate" column="REVIEW_DATE"/>
	    <result property="status" column="STATUS"/>
	    <result property="productNo" column="PRODUCT_NO"/>
	    <result property="memberId" column="MEMBER_ID"/>
	    <result property="memberName" column="MEMBER_NAME"/>
	    <result property="productChange" column="PRODUCT_CHANGE"/>
	</resultMap>
	
	<select id="selectReviewList" parameterType="_int" resultMap="reviewResultMap">
	    SELECT
	        R.REVIEW_NO,
	        R.REVIEW_TITLE,
	        R.REVIEW_CONTENT,
	        R.RATING,
	        R.REVIEW_THUMBNAIL_ORIGIN,
	        R.REVIEW_THUMBNAIL_CHANGE,
	        R.REVIEW_DATE,
	        R.STATUS,
	        R.PRODUCT_NO,
	        R.MEMBER_ID,
	        M.MEMBER_NAME
	    FROM REVIEW R
	    JOIN MEMBER M ON R.MEMBER_ID = M.MEMBER_ID
	    WHERE R.PRODUCT_NO = #{productNo}
	      AND R.STATUS = 'Y'
	    ORDER BY R.REVIEW_DATE DESC
	</select>

	
	<select id="selectAllReviewList" resultMap="reviewResultMap">
        SELECT
            R.REVIEW_NO,
            R.REVIEW_TITLE,
            R.REVIEW_CONTENT,
            R.RATING,
            R.REVIEW_THUMBNAIL_ORIGIN,
            R.REVIEW_THUMBNAIL_CHANGE,
            R.REVIEW_DATE,
            R.STATUS,
            R.PRODUCT_NO,
            R.MEMBER_ID,
            M.MEMBER_NAME,
            P.PRODUCT_CHANGE AS PRODUCT_CHANGE
        FROM REVIEW R
        JOIN MEMBER M ON R.MEMBER_ID = M.MEMBER_ID
        JOIN PRODUCT P ON R.PRODUCT_NO = P.PRODUCT_NO
        WHERE R.STATUS = 'Y'
        ORDER BY R.REVIEW_DATE DESC
    </select>


	<select id="selectBestReviewList" resultMap="reviewResultMap">
	    SELECT * FROM (
	        SELECT
	            R.REVIEW_NO,
	            R.REVIEW_TITLE,
	            R.REVIEW_CONTENT,
	            R.RATING,
	            R.REVIEW_THUMBNAIL_ORIGIN,
	            R.REVIEW_THUMBNAIL_CHANGE,
	            R.REVIEW_DATE,
	            R.STATUS,
	            R.PRODUCT_NO,
	            R.MEMBER_ID,
	            M.MEMBER_NAME,
	            P.PRODUCT_CHANGE
	        FROM REVIEW R
	        JOIN MEMBER M ON R.MEMBER_ID = M.MEMBER_ID
	        JOIN PRODUCT P ON R.PRODUCT_NO = P.PRODUCT_NO
	        WHERE R.STATUS = 'Y'
	        ORDER BY R.RATING DESC, R.REVIEW_DATE DESC
	    )
	    WHERE ROWNUM &lt;= 5
	</select>


</mapper>